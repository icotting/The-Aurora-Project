<html>
<head>
	<title>RESTful Web Application</title>
	<script type="text/javascript" src="resources/js/jquery-1.6.1.min.js"></script> 
	<script type="text/javascript" src="resources/js/highcharts/highcharts.js"></script>
	<script type="text/javascript" src="resources/js/highcharts/exporting.js"></script>
	
	<style>
		body { font-family: Calibri, Helvetica, Arial; font-size: 10pt; }
		td { font-size: 10pt; }
	</style>
	<script type="text/javascript">		
		function query() {
			var query_str = $("#query").val();
			$("#results").empty();
			$.getJSON("rest/dispatchXML/places/names/"+query_str+".json", 
					function(json) {
						if ( json ) {

						var series = new Array();
						
						$.each(json.references, function(i, reference) {
							var arr = new Array();
							$.each(reference.referenceCounts, function(i, count) {
								arr.push(parseInt(count));
							});
							series.push({ name : reference.placeName, data : arr });
						});
						
						var chart = new Highcharts.Chart({
						      chart: {
						         renderTo: 'results',
						         defaultSeriesType: 'line', 
						         marginRight: 300
						      },
						      title: {
						         text: 'Instances of references to '+query_str
						      },
						      subtitle: {
						         text: 'Source: Richmond Daily Dispatch XML (1860 - 1865)'
						      },
						      tooltip: {
						         formatter: function() {
						            return ''+
						                this.series.name +': '+ this.y +' ';
						         }
						      },
						      xAxis: {
						          categories: json.dates,
						          title: {
						             text: null
						          }
						       },
						       yAxis: {
						          min: 0,
						          title: {
						             text: 'Number of References',
						             align: 'high'
						          }
						       },						      
						      plotOptions: {
						         bar: {
						            dataLabels: {
						               enabled: true
						            }
						         }
						      },
						      legend: {
						    	 enabled: true,
						         layout: 'vertical',
						         align: 'right',
						         verticalAlign: 'top',
						         x: 0,
						         y: 100,
						         borderWidth: 1,
						         backgroundColor: '#FFFFFF',
						         width: 300
						      },
						      credits: {
						         enabled: false
						      },
						      series: series
						   });
						
						} else {
							$("#results").append("No results for "+query_str);
						}
					});
		}
	</script>
</head>
<body>
	<input type="text" id="query"/>
	<input type="button" onclick="query()" value="Search"/>
	<div id="results" style="width: 900px; height: 400px;""></div>
</body>
</html>
