/* Created on Aug 16, 2011 */
package edu.unl.cig.aurora.model.gis;

import java.util.ArrayList;

/**
 * @author Ian Cottingham 
 *
 */
public class Line {

	private final String coordString; 
	private final boolean polygon;
	
	public Line(String coordString, boolean polygon) {
		this.coordString = coordString;
		this.polygon = polygon;
	}
	
	public ArrayList<Coordinate> getCoordinates() { 
		
		ArrayList<Coordinate> coords = new ArrayList<Coordinate>();
		String[] c = coordString.split(" ");
		for ( String coord : c ) {
			coords.add(new Coordinate(coord));
		}
		
		return coords;
	}
	
	public ArrayList<Coordinate> simplify(float tolerance) { 
		ArrayList<Coordinate> coords = this.getCoordinates();
		
		coords.get(0).mark();
		if ( polygon ) { // if it is a polygon the last point is the same as the first
			coords.get(coords.size()-2).mark();
		} else {
			coords.get(coords.size()-1).mark();
		}
		
		int len = polygon ? coords.size() - 2 : coords.size() - 1;
		simplify(coords, tolerance, 0, len);
		
		ArrayList<Coordinate> ret = new ArrayList<Coordinate>();
		for ( Coordinate coord : coords ) { 
			if ( coord.isMarked() ) { 
				ret.add(coord);
			}
		}

		if ( polygon ) { // ensure the polygon is closed
			ret.add(coords.get(0));
		}
		
		return ret;
	}
	
	private void simplify(ArrayList<Coordinate> coords, float tolerance, int i, int j) {
		if ( i > j+1 ) {
			return;
		}
		
		Coordinate seg_start = coords.get(i);
		Coordinate seg_end = coords.get(j);
	
		double max_dist = 0;
		int max_index = i;
		
		Coordinate coord;
		for ( int pos = i+1; pos<j; pos++ ) {
			coord = coords.get(pos);
			double dist = coord.distanceFrom(seg_start)+coord.distanceFrom(seg_end);
			if ( dist > max_dist ) { 
				max_dist = dist;
				max_index = pos;
			}
		}
		
		if ( max_dist > tolerance ) {
			coords.get(max_index).mark();
			simplify(coords, tolerance, i, max_index);
			simplify(coords, tolerance, max_index, j);
		}
		
	}
	
	public static void main(String[] args) { 
		String cstring = "-85.063278,38.564783 -85.063401,38.564849 -85.065699,38.566294 -85.068650,38.569246 -85.071257,38.571969 -85.072980,38.573934 -85.073647,38.574696 -85.075199,38.576796 -85.075830,38.578224 -85.075966,38.580053 -85.076038,38.581762 -85.075811,38.583492 -85.075714,38.585486 -85.075398,38.587378 -85.075108,38.588568 -85.074808,38.590251 -85.074424,38.591862 -85.074094,38.593552 -85.074082,38.595222 -85.074157,38.596230 -85.074194,38.596899 -85.074682,38.596839 -85.075165,38.596780 -85.083602,38.595747 -85.099596,38.593789 -85.113639,38.592090 -85.114401,38.591998 -85.124952,38.590652 -85.133513,38.589446 -85.143328,38.588471 -85.148036,38.588110 -85.152725,38.587594 -85.154041,38.587450 -85.168233,38.585740 -85.171815,38.582659 -85.172715,38.581819 -85.173325,38.581381 -85.179411,38.577021 -85.183052,38.574412 -85.186405,38.572032 -85.191229,38.568508 -85.193597,38.566780 -85.194214,38.566312 -85.194478,38.566112 -85.201265,38.560970 -85.212123,38.552743 -85.226421,38.541910 -85.236817,38.534033 -85.237321,38.533651 -85.247377,38.526020 -85.249955,38.523876 -85.254675,38.519190 -85.269706,38.504400 -85.273838,38.500574 -85.274360,38.500065 -85.275000,38.499524 -85.275174,38.499350 -85.278966,38.496721 -85.278983,38.496664 -85.279860,38.496147 -85.283888,38.496484 -85.284909,38.496647 -85.285897,38.496805 -85.286887,38.497172 -85.288546,38.497904 -85.289158,38.498019 -85.289772,38.497942 -85.291167,38.497767 -85.292769,38.497767 -85.293992,38.497836 -85.294516,38.497767 -85.295040,38.497699 -85.296383,38.497295 -85.297603,38.497013 -85.298069,38.496967 -85.298622,38.496990 -85.299961,38.497173 -85.301883,38.497631 -85.302698,38.497631 -85.304912,38.497357 -85.305523,38.497403 -85.305855,38.497490 -85.306047,38.497540 -85.306542,38.497952 -85.307532,38.498936 -85.307715,38.499020 -85.307882,38.499096 -85.308260,38.499142 -85.309600,38.499188 -85.311027,38.497884 -85.311376,38.497769 -85.311434,38.497495 -85.312279,38.496694 -85.312279,38.496579 -85.312366,38.496488 -85.312483,38.494520 -85.312570,38.494222 -85.312861,38.493719 -85.313764,38.492620 -85.313939,38.492506 -85.315069,38.492178 -85.315418,38.491919 -85.315705,38.491604 -85.320764,38.486232 -85.342417,38.463242 -85.343035,38.462585 -85.345929,38.459514 -85.340722,38.453456 -85.336028,38.447993 -85.333889,38.445498 -85.331729,38.442979 -85.331662,38.442868 -85.331574,38.441770 -85.330567,38.435829 -85.329052,38.426888 -85.329032,38.426771 -85.329011,38.426437 -85.328705,38.424652 -85.328176,38.421565 -85.326181,38.409923 -85.326018,38.408971 -85.325434,38.405563 -85.325296,38.404763 -85.325232,38.404388 -85.325149,38.403900 -85.325132,38.403799 -85.318109,38.396664 -85.317840,38.396392 -85.316710,38.395244 -85.311317,38.389765 -85.310218,38.388632 -85.307925,38.386305 -85.307143,38.385511 -85.306503,38.384862 -85.306301,38.384658 -85.306134,38.384488 -85.296850,38.375067 -85.295652,38.373894 -85.294387,38.372427 -85.288885,38.365455 -85.285974,38.361749 -85.283047,38.358021 -85.282784,38.358001 -85.278648,38.357701 -85.273672,38.357333 -85.271426,38.357168 -85.266915,38.356755 -85.266087,38.356741 -85.263980,38.356585 -85.260011,38.356241 -85.256489,38.355967 -85.254917,38.355846 -85.249956,38.355436 -85.247682,38.355336 -85.246720,38.355262 -85.234740,38.354339 -85.234163,38.354295 -85.231570,38.354095 -85.226947,38.353741 -85.221401,38.353316 -85.210700,38.352467 -85.208684,38.352306 -85.204773,38.351992 -85.197832,38.351442 -85.188459,38.350715 -85.187163,38.350642 -85.186013,38.350546 -85.178504,38.349922 -85.172536,38.349450 -85.166546,38.348977 -85.155284,38.348121 -85.153131,38.347954 -85.149974,38.347709 -85.147170,38.347492 -85.144230,38.347261 -85.139771,38.346913 -85.135641,38.346585 -85.132587,38.346342 -85.131070,38.346226 -85.127293,38.345938 -85.124954,38.345737 -85.120079,38.345289 -85.119771,38.345264 -85.117123,38.345052 -85.114622,38.344852 -85.113665,38.344775 -85.112852,38.344711 -85.111754,38.344623 -85.110434,38.344517 -85.110170,38.344495 -85.087475,38.342679 -85.086502,38.342602 -85.077644,38.341894 -85.076601,38.341811 -85.054998,38.340084 -85.048856,38.339593 -85.046300,38.339387 -85.037769,38.338696 -85.036303,38.338578 -85.036064,38.338523 -85.028842,38.337955 -85.011688,38.336607 -85.010656,38.336526 -84.999952,38.335686 -84.999125,38.335717 -84.997514,38.335614 -84.994002,38.337121 -84.992332,38.337839 -84.985967,38.340574 -84.981526,38.342483 -84.971750,38.346685 -84.961736,38.350990 -84.938764,38.360863 -84.921151,38.368432 -84.915627,38.370807 -84.908221,38.373991 -84.906205,38.374858 -84.905337,38.373627 -84.905175,38.373395 -84.892649,38.355612 -84.892379,38.355229 -84.892175,38.355229 -84.891478,38.355160 -84.890984,38.354908 -84.889618,38.354884 -84.889241,38.354747 -84.889096,38.354495 -84.888747,38.354243 -84.887662,38.354075 -84.887410,38.354037 -84.886307,38.353579 -84.885842,38.353281 -84.885668,38.352983 -84.885465,38.352365 -84.885146,38.352068 -84.884898,38.352012 -84.884738,38.351976 -84.883743,38.351950 -84.883741,38.352216 -84.883416,38.354271 -84.883170,38.355512 -84.882559,38.356477 -84.882281,38.356717 -84.881810,38.356860 -84.880860,38.356862 -84.878644,38.356778 -84.876317,38.356644 -84.874949,38.356620 -84.873686,38.356624 -84.872275,38.356523 -84.870536,38.356728 -84.870424,38.356764 -84.869860,38.356952 -84.869040,38.357393 -84.868629,38.357803 -84.868081,38.358930 -84.867315,38.360831 -84.866946,38.363136 -84.866985,38.365740 -84.867692,38.367540 -84.868676,38.369196 -84.870092,38.370272 -84.871520,38.371163 -84.873521,38.371959 -84.874949,38.372582 -84.877236,38.373385 -84.878572,38.373594 -84.881806,38.374104 -84.884337,38.374352 -84.886837,38.374697 -84.888920,38.374829 -84.890787,38.375069 -84.893357,38.375226 -84.894729,38.375609 -84.895763,38.376090 -84.896748,38.376780 -84.897620,38.377415 -84.898217,38.378292 -84.898548,38.379065 -84.898787,38.379959 -84.898750,38.380636 -84.898519,38.381709 -84.898065,38.382855 -84.897762,38.383671 -84.897439,38.384591 -84.897403,38.385526 -84.897592,38.386566 -84.897783,38.388016 -84.897807,38.388789 -84.897759,38.389491 -84.897385,38.390484 -84.896786,38.391485 -84.896066,38.392930 -84.895183,38.394263 -84.893944,38.395895 -84.893101,38.397059 -84.892042,38.398142 -84.890424,38.399687 -84.889020,38.401239 -84.888471,38.401990 -84.888269,38.402588 -84.887909,38.404378 -84.887567,38.405597 -84.887072,38.407025 -84.886474,38.408220 -84.885896,38.409286 -84.885204,38.410110 -84.884564,38.410878 -84.883760,38.411735 -84.882854,38.412786 -84.882050,38.413667 -84.881154,38.414661 -84.880483,38.415477 -84.880270,38.415961 -84.880031,38.417357 -84.879963,38.418179 -84.879934,38.418518 -84.880613,38.419355 -84.881812,38.420029 -84.883462,38.420685 -84.885501,38.421389 -84.887438,38.422093 -84.889476,38.422796 -84.891167,38.423364 -84.892508,38.423699 -84.893759,38.424219 -84.896034,38.425180 -84.897059,38.425475 -84.901216,38.426253 -84.903141,38.426602 -84.905588,38.427110 -84.907114,38.427452 -84.908907,38.427769 -84.910842,38.428159 -84.911877,38.428534 -84.913118,38.429232 -84.914617,38.430155 -84.915561,38.430700 -84.916554,38.430947 -84.917762,38.431015 -84.919726,38.431082 -84.922345,38.431106 -84.924577,38.431284 -84.925919,38.431667 -84.926679,38.432213 -84.927225,38.433074 -84.927649,38.433927 -84.928024,38.435263 -84.928143,38.436472 -84.928046,38.437569 -84.927673,38.438683 -84.926994,38.439789 -84.926353,38.440630 -84.925396,38.441544 -84.924326,38.442338 -84.923336,38.443002 -84.921775,38.443732 -84.920539,38.444268 -84.918824,38.445024 -84.917108,38.445609 -84.915024,38.446462 -84.913594,38.447160 -84.912124,38.447858 -84.910982,38.448603 -84.910064,38.449388 -84.909527,38.450309 -84.909194,38.451414 -84.909118,38.452487 -84.909276,38.453518 -84.909506,38.454461 -84.910076,38.456056 -84.910563,38.457280 -84.911286,38.458543 -84.911976,38.459509 -84.912861,38.460401 -84.913776,38.461277 -84.914905,38.461902 -84.916198,38.462511 -84.917438,38.463015 -84.919253,38.463654 -84.920649,38.464271 -84.921787,38.464654 -84.922628,38.464869 -84.922804,38.464841 -84.923405,38.464746 -84.924887,38.464354 -84.926501,38.463631 -84.928256,38.462658 -84.931877,38.460131 -84.933232,38.458966 -84.934627,38.457518 -84.936009,38.455788 -84.937115,38.453914 -84.937772,38.452316 -84.938124,38.451137 -84.938313,38.450056 -84.938431,38.449218 -84.938353,38.447960 -84.938254,38.446574 -84.937984,38.443987 -84.937979,38.442979 -84.937971,38.441568 -84.937963,38.440004 -84.937947,38.438819 -84.937877,38.437295 -84.937789,38.436118 -84.937660,38.434813 -84.937570,38.433337 -84.937502,38.431967 -84.937617,38.430548 -84.937979,38.429395 -84.938598,38.428481 -84.939761,38.427800 -84.941140,38.427344 -84.942877,38.426927 -84.944727,38.426574 -84.946414,38.426424 -84.948296,38.426473 -84.949964,38.426580 -84.950937,38.426762 -84.952116,38.427121 -84.953869,38.427897 -84.954885,38.428514 -84.956026,38.429389 -84.956879,38.430112 -84.958092,38.431196 -84.958926,38.432120 -84.959482,38.432675 -84.959555,38.432748 -84.960613,38.433808 -84.961808,38.435045 -84.962796,38.436082 -84.963139,38.436951 -84.963264,38.437451 -84.963265,38.437544 -84.963266,38.437717 -84.963084,38.438128 -84.962515,38.438896 -84.961407,38.440456 -84.960758,38.441212 -84.960126,38.441952 -84.958580,38.443465 -84.957542,38.444614 -84.957138,38.445478 -84.956591,38.446544 -84.956177,38.447529 -84.956026,38.448078 -84.955898,38.448941 -84.955802,38.450102 -84.955694,38.450885 -84.955453,38.451748 -84.955017,38.452613 -84.954592,38.453412 -84.953748,38.454366 -84.952986,38.455425 -84.952347,38.456395 -84.951828,38.457001 -84.951738,38.457461 -84.951641,38.458469 -84.951585,38.461308 -84.951781,38.463427 -84.952126,38.464805 -84.952825,38.467181 -84.953728,38.469492 -84.954587,38.471182 -84.955671,38.472763 -84.955701,38.472807 -84.956107,38.473124 -84.956189,38.473188 -84.956472,38.473409 -84.958537,38.474692 -84.961876,38.476799 -84.964600,38.478806 -84.966069,38.479711 -84.968944,38.481241 -84.972936,38.482912 -84.977061,38.484340 -84.979031,38.485075 -84.981318,38.485671 -84.982948,38.486117 -84.985460,38.486575 -84.987100,38.486940 -84.988843,38.487418 -84.989839,38.487898 -84.990693,38.488523 -84.991571,38.489850 -84.991955,38.490776 -84.992165,38.491517 -84.992429,38.492975 -84.992548,38.493943 -84.992328,38.494814 -84.991753,38.496251 -84.990711,38.498521 -84.989664,38.500066 -84.987708,38.502660 -84.985813,38.504588 -84.983438,38.506815 -84.981296,38.508735 -84.978634,38.511122 -84.977927,38.511929 -84.977292,38.512744 -84.977128,38.513316 -84.977210,38.513946 -84.977629,38.514881 -84.978356,38.515784 -84.979656,38.516768 -84.980762,38.517421 -84.981816,38.517880 -84.983383,38.518203 -84.985359,38.518259 -84.990972,38.518257 -84.994300,38.518208 -84.995303,38.518071 -84.998467,38.517473 -84.999951,38.517302 -85.002519,38.516316 -85.005033,38.515169 -85.007411,38.513508 -85.009527,38.512060 -85.011951,38.509753 -85.015243,38.506676 -85.017526,38.504534 -85.017748,38.504327 -85.019884,38.503766 -85.022038,38.504012 -85.024608,38.504446 -85.027025,38.505389 -85.028512,38.506580 -85.028684,38.506876 -85.028965,38.507496 -85.029204,38.508023 -85.029774,38.510878 -85.029113,38.513452 -85.028110,38.515838 -85.026904,38.518395 -85.026315,38.520928 -85.025354,38.523426 -85.024065,38.525017 -85.021842,38.527636 -85.019107,38.530795 -85.017277,38.533062 -85.015181,38.535816 -85.014218,38.537322 -85.013024,38.540419 -85.012842,38.541922 -85.012952,38.544019 -85.012744,38.546167 -85.012091,38.547757 -85.010723,38.549115 -85.008520,38.549926 -85.006259,38.550529 -85.004204,38.551080 -85.002685,38.552093 -85.002227,38.553236 -85.003352,38.554294 -85.006522,38.557355 -85.006707,38.557534 -85.007585,38.559031 -85.007689,38.559062 -85.009357,38.560960 -85.011267,38.562145 -85.014551,38.563118 -85.017657,38.563916 -85.020714,38.565327 -85.022334,38.566114 -85.023399,38.566631 -85.026534,38.567840 -85.029472,38.568978 -85.032178,38.569862 -85.035119,38.571137 -85.037712,38.572886 -85.039944,38.573735 -85.041257,38.574008 -85.042354,38.573856 -85.043026,38.573540 -85.045124,38.572608 -85.046946,38.571728 -85.049267,38.570656 -85.052295,38.569034 -85.055371,38.567282 -85.057875,38.565666 -85.060316,38.564471 -85.062140,38.564172 -85.063278,38.564783";
	
		Line l = new Line(cstring, true);
		ArrayList<Coordinate> coords = l.getCoordinates();
		ArrayList<Coordinate> s_coords = l.simplify(0.53f);
		
		System.out.println(coords.size()+" greater than "+s_coords.size());
		
	}
}
